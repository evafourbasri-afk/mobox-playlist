name: Stream Extractor Runner

on:
  # Memungkinkan pemicuan workflow secara manual dari GitHub UI
  workflow_dispatch:
    inputs:
      # URL ini HARUS berupa URL halaman utama film, bukan URL embednya.
      video_page_url:
        description: 'URL Halaman Film Induk (e.g., tv7.lk21official.cc/...)'
        required: true
        default: 'https://tv7.lk21official.cc/little-amelie-character-rain-2025'

jobs:
  extract_stream:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout Repository
      uses: actions/checkout@v4

    # Langkah 1: Setup Python
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    # Langkah 2: Instal dependensi Python
    - name: Install Python dependencies
      run: |
        pip install playwright

    # Langkah 3: Instal browser Chromium untuk Playwright (Wajib)
    - name: Install Playwright Browsers
      run: |
        playwright install chromium
        
    # Langkah 4: Jalankan Skrip Ekstraksi (Menggunakan Halaman Induk sebagai Target)
    - name: Run Stream Extractor (Targeting Parent Page)
      run: |
        # Menggunakan input URL halaman film sebagai argumen.
        # Skrip Python sekarang akan memuat halaman ini, mencari iframe, dan menavigasi ke iframe tersebut.
        python stream_extractor.py "${{ github.event.inputs.video_page_url }}"
        
    # Langkah 5: Tampilkan dan Simpan Hasil (File streams.json)
    - name: Display Result
      run: |
        echo "--- HASIL EKSTRAKSI ---"
        cat output/streams.json
        echo "----------------------"
        
    # Opsional: Upload file hasil
    - name: Upload Stream Result Artifact
      uses: actions/upload-artifact@v4
      with:
        name: extracted-streams
        path: output/streams.json
